;(()=>{"use strict";
if(window.HC_WIDGET_LOADED) return; window.HC_WIDGET_LOADED=true;

const API="https://hansel-cottage.onrender.com";

function onReady(fn){if(document.readyState==="complete"||document.readyState==="interactive"){setTimeout(fn,0)}else{document.addEventListener("DOMContentLoaded",fn,{once:true})}}
function css(){const s=document.createElement("style");s.textContent="#hc-b{position:fixed;bottom:20px;right:20px;background:#4a5568;color:#fff;border-radius:50%;width:56px;height:56px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:24px;box-shadow:0 4px 8px rgba(0,0,0,.2);z-index:2147483647}#hc-w{position:fixed;bottom:84px;right:20px;width:320px;max-height:420px;background:#fff;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.3);display:none;flex-direction:column;overflow:hidden;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;z-index:2147483647}#hc-h{background:#4a5568;color:#fff;padding:10px;font-weight:700}#hc-m{flex:1;padding:10px;overflow-y:auto;font-size:14px}#hc-i{display:flex;border-top:1px solid #ddd}#hc-t{flex:1;border:0;padding:8px;font-size:14px;outline:0}#hc-s{background:#4a5568;color:#fff;border:0;padding:0 14px;cursor:pointer;font-size:14px}",document.head.appendChild(s)}
async function chat(message){const r=await fetch(API+"/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message})});if(!r.ok)throw new Error("chat "+r.status);return r.json()}
function mount(){css();const b=document.createElement("div");b.id="hc-b";b.textContent="💬";document.body.appendChild(b);const w=document.createElement("div");w.id="hc-w";w.innerHTML='<div id="hc-h">Hansel Cottage</div><div id="hc-m"></div><div id="hc-i"><input id="hc-t" placeholder="Ask anything about dates or pricing..."><button id="hc-s">Send</button></div>';document.body.appendChild(w);const m=w.querySelector("#hc-m"),t=w.querySelector("#hc-t"),s=w.querySelector("#hc-s");function add(u,x){const d=document.createElement("div");d.innerHTML="<strong>"+u+":</strong> "+x;m.appendChild(d);m.scrollTop=m.scrollHeight}s.onclick=async()=>{const text=t.value.trim();if(!text)return;add("You",text);t.value="";try{const out=await chat(text);add("Bot",out.answer||"Sorry, I didn't understand.")}catch(e){add("Bot","⚠️ Error contacting server.")}};t.addEventListener("keypress",e=>{if(e.key==="Enter")s.click()});b.onclick=()=>{w.style.display=w.style.display==="flex"?"none":"flex";if(w.style.display==="flex")t.focus()};console.log("[hc] widget mounted")}
onReady(mount);
})();
